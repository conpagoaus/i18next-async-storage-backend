(function(g,f){typeof exports==='object'&&typeof module!=='undefined'?module.exports=f():typeof define==='function'&&define.amd?define(f):(g=typeof globalThis!=='undefined'?globalThis:g||self,g.i18nextAsyncStorageBackend=f());})(this,(function(){'use strict';function _classCallCheck(instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
}

function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}

function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  Object.defineProperty(Constructor, "prototype", {
    writable: false
  });
  return Constructor;
}var arr=[],each=arr.forEach,slice=arr.slice;function defaults(r){return each.call(slice.call(arguments,1),(function(e){if(e)for(var n in e)void 0===r[n]&&(r[n]=e[n]);})),r}var AsyncStorage=require("@react-native-async-storage/async-storage")||{},storage={setItem:function(e,t){if(AsyncStorage)return AsyncStorage.setItem(e,t)},getItem:function(e,t){if(AsyncStorage)return AsyncStorage.getItem(e,t)}};function getDefaults(){return {prefix:"i18next_res_",expirationTime:6048e5,versions:{}}}var Cache=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this.init(t,n),this.type="backend";}return _createClass(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.services=e,this.options=defaults(t,this.options||{},getDefaults());}},{key:"read",value:function(e,t,n){var s=this,i=(new Date).getTime();if(!AsyncStorage)return n(null,null);storage.getItem("".concat(this.options.prefix).concat(e,"-").concat(t)).then((function(t){if(t&&(t=JSON.parse(t)).i18nStamp&&t.i18nStamp+s.options.expirationTime>i&&s.options.versions[e]===t.i18nVersion)return delete t.i18nVersion,delete t.i18nStamp,n(null,t);n(null,null);})).catch((function(e){console.warn(e),n(null,null);}));}},{key:"save",value:function(e,t,n){AsyncStorage&&(n.i18nStamp=(new Date).getTime(),this.options.versions[e]&&(n.i18nVersion=this.options.versions[e]),storage.setItem("".concat(this.options.prefix).concat(e,"-").concat(t),JSON.stringify(n)));}}]),e}();Cache.type="backend";return Cache;}));